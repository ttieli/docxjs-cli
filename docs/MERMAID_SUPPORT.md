# DocxJS 转换器 Mermaid 离线支持说明 (最终版)

**DocxJS Converter** 现已原生支持渲染 Markdown 文件中的 **Mermaid** 图表，并将其转换为高清晰度的图片嵌入到最终的 `.docx` 文档中。

---

## 🛠 架构设计 (Pure Local Architecture)

为了确保在内网环境下的绝对安全与稳定，我们放弃了所有在线 API（如 mermaid.ink），采用了**完全本地化**的渲染架构。

### 核心流程
1.  **本地库注入**：转换器直接读取内置的 `mermaid.min.js` (v10+) 脚本内容。
2.  **无头浏览器渲染**：通过 **Playwright** 启动本地 Chrome 实例，注入脚本并执行 `mermaid.render()`。
3.  **精准坐标截图**：
    *   **高 DPI**：设置 `deviceScaleFactor: 3`，确保图表在打印时达到“视网膜”级清晰度。
    *   **自动裁剪**：通过获取 SVG 元素的精确边界进行截图，**彻底消除了图片右侧的空白区域**。
    *   **布局优化**：强制设置超大视口 (2400x2000)，防止复杂图表在渲染时因空间不足而发生元素重叠。

---

## 📦 支持图表类型全清单

得益于内置的 Mermaid v10 核心，本工具支持以下所有图表：

### 1. 经典图表 (Stable)
- **流程图 (Flowcharts)**：支持 `graph TD/LR`、子图及自定义样式。
- **时序图 (Sequence Diagrams)**：支持自动编号、参与者激活/去激活。
- **类图 (Class Diagrams)**：支持继承、成员方法及可见性标识。
- **状态图 (State Diagrams v2)**：支持复合状态。
- **实体关系图 (ER Diagrams)**：支持复杂的多表关联建模。
- **甘特图 (Gantt)**：支持项目进度管理。
- **饼图 (Pie Charts)**：支持数据占比分布。

### 2. 现代与高级图表 (New)
- **思维导图 (Mindmaps)**：层级化脑图。
- **时间轴 (Timeline)**：大事件年表。
- **用户旅程图 (User Journey)**：产品体验链路。
- **Git 图 (GitGraph)**：版本分支模型。
- **C4 架构图 (C4Context)**：系统上下文架构。
- **需求图 (Requirement Diagram)**：需求建模。

### 3. 特殊图表 (Specialized)
- **桑基图 (Sankey)**：能量/资金流量分析。
- **XY 图表 (XYChart)**：基础数据折线/柱状图。
- **象限图 (Quadrant Chart)**：战略优先级分析。

---

## 🚀 平台支持情况

| 平台 | 支持状态 | 离线能力 | 截图质量 |
| :--- | :--- | :--- | :--- |
| **命令行 (CLI)** | ✅ 完全支持 | 100% 离线 | 3x DPI (高清) |
| **桌面端 (App)** | ✅ 完全支持 | 100% 离线 | 3x DPI (高清) |
| **网页 API** | ✅ 完全支持 | 100% 离线 | 3x DPI (高清) |

---

## 💡 使用建议
- 无需任何配置，直接在 Markdown 中编写 ```mermaid 代码块即可。
- 对于极其庞大的图表，本工具会自动将其等比例缩放到 Word A4 页面的最大宽度（约 600px），并保持清晰度。