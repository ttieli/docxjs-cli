# 技术方案对比分析：docxjs-cli (当前方案) vs Microsoft MarkItDown

本文档旨在对比我们当前采用的 Word 导入方案与微软开源的 `markitdown` 库在“精细度”、功能侧重点及适用场景上的差异。

## 1. 核心机制对比

### A. 当前方案 (docxjs-cli Hybrid)
我们的方案采用了 **“双管齐下”** 的混合策略，明确区分了**内容**与**样式**。

*   **内容提取 (Node.js)**:
    *   **组件**: `mammoth.js` + `turndown` + `turndown-plugin-gfm`。
    *   **流程**: Docx -> HTML -> Markdown。
    *   **特点**: `mammoth` 专注于生成语义化的 HTML（忽略视觉样式，只保留结构），这使得转换出的 Markdown 非常干净，适合二次编辑。表格通过 GFM 插件支持良好。
*   **样式提取 (Python)**:
    *   **组件**: `python-docx` (通过 `style_extractor.py`)。
    *   **流程**: 直接解析 Docx 的 XML 底层。
    *   **特点**: **这是核心差异点**。我们不只是要文本，我们专门提取了“字体名称”、“页边距数值”、“行距值”等元数据。Markdown 本身不支持记录这些（Markdown 只有 H1/H2，没有“方正小标宋”），但我们通过**侧边信道（JSON 配置）**保留了这些“精细”的视觉信息。

### B. Microsoft MarkItDown
微软的 `markitdown` 是一个 Python 库，旨在将各种文件（PDF, Docx, Excel, PPT）转换为 Markdown，主要用于**大模型数据清洗 (LLM Ingestion)**。

*   **内容提取**:
    *   **组件**: 内部主要依赖 `mammoth` (Python 版) 或类似的解析逻辑，若是图片/复杂布局则调用 OpenAI Vision API。
    *   **流程**: Docx -> Text/Markdown。
    *   **特点**: 它的目标是**“可读性”**。它会将文档“拍平”为文本流，以便 AI 理解。
*   **样式提取**:
    *   **特点**: **几乎为零**。MarkItDown 的设计哲学的本质就是**丢弃样式**。它的目的是让 GPT-4 阅读文档，而 GPT-4 不需要知道你的标题是“宋体”还是“黑体”。它输出的只是纯 Markdown。

---

## 2. “精细度”维度分析

如果“精细度”定义为 **“对原始 Word 文档视觉还原的能力”**：

| 维度 | 当前方案 (docxjs-cli) | Microsoft MarkItDown | 胜出者 |
| :--- | :--- | :--- | :--- |
| **内容结构** (标题/列表) | ✅ 优秀 (基于 Mammoth) | ✅ 优秀 (基于 Mammoth) | 平局 |
| **表格处理** | ✅ 支持标准 Markdown 表格 | ✅ 支持，有时会简化为文本 | 当前方案略优 (针对编辑优化) |
| **字体识别** (宋体/仿宋) | ✅ **支持** (通过 Python 脚本提取) | ❌ **不支持** (直接丢弃) | **当前方案** |
| **页边距/版式** | ✅ **支持** (提取精确 cm 值) | ❌ **不支持** | **当前方案** |
| **颜色/字号** | ✅ **支持** (提取并映射到配置) | ❌ **不支持** | **当前方案** |
| **多格式支持** (PDF/Excel) | ❌ 仅支持 Word/Markdown | ✅ **全能** (PDF, Excel, PPT) | MarkItDown |

## 3. 结论：为什么我们不换用 MarkItDown？

虽然 `markitdown` 是微软出品且非常强大，但它**并不适合**我们的核心业务场景——**公文格式标准化生成**。

1.  **目标冲突**：
    *   **MarkItDown** 是为了**“把格式洗掉”**，只留内容给 AI 看。
    *   **我们** 是为了**“把格式留住”**（或者把不规范的格式标准化），要生成红头文件，必须知道原来的标题是不是“方正小标宋”。

2.  **Markdown 的局限性**：
    Markdown 格式本身无法承载“页边距 3.7cm”这样的信息。如果我们只用 MarkItDown 把它转成 Markdown，那么所有公文的版式信息在这一步就**永久丢失**了。我们的方案通过“Markdown 存内容” + “JSON 存样式”的方式，巧妙地规避了这个局限。

3.  **技术栈匹配**：
    当前后端核心是 Node.js，使用 `mammoth.js` 能够直接在内存中处理 Buffer，无需频繁的跨语言调用（除了必要的样式提取）。引入 `markitdown` 需要全盘 Python 化或增加复杂的 Python 桥接，收益有限。

### 总结

*   如果您需要做一个**“文档知识库”**（RAG），把几万份公文喂给 AI 聊天，**MarkItDown 是更好的选择**。
*   如果您需要做一个**“公文格式排版工具”**，需要精确控制字体、边距和红头，**当前方案更加精细且不可替代**。
